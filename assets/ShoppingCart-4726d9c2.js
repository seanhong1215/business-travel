import{_ as m,C as v,D as C,c as d,d as t,F as p,r as _,h as g,E as b,G as y,g as f,t as c,o as r,H as x,I as S,p as w,i as k}from"./index-65aa15c9.js";const I={name:"ShoppingCart",data(){return{loadingStatus:{loadingItem:""},isLoading:!1,finalTotal:0,total:0,couponCode:"",cart:{}}},methods:{getCart(){v().then(s=>{this.cart=s.data.data}).catch(s=>{alert(s.response.data.message)})},removeCartItem(s){this.loadingStatus.loadingItem=s,C(s).then(o=>{alert(o.data.message),this.loadingStatus.loadingItem="",this.getCart()}).catch(o=>{alert(o.response.data.message)})},selectCartQty(s,o){const i=`https://vue3-course-api.hexschool.io/v2/api/shinyhung/cart/${s}`,h={product_id:s,qty:o};this.$http.put(i,{data:h}).then(()=>{this.isLoading=!1,this.$swal.fire({icon:"success",title:"更新數量"})}),this.getCart()},getCoupons(){this.isLoading=!0;const s={data:{code:this.couponCode}},o="https://vue3-course-api.hexschool.io/v2/api/shinyhung/coupon";this.$http.post(o,s).then(i=>{this.isLoading=!1,this.$swal.fire({icon:"success",title:"套用折扣碼成功"}),this.finalTotal=i.data.data.final_total,this.couponCode=""}).catch(i=>{this.isLoading=!1,this.$swal.fire({icon:"error",title:i.response.data.message}),this.couponCode=""})}},watch:{total(){this.total-this.finalTotal!==0&&(this.couponCode="")}},mounted(){this.getCart()}},n=s=>(w("data-v-723dc839"),s=s(),k(),s),T=n(()=>t("section",{class:"banner"},[t("div",{class:"banner-content-wrap"},[t("h3",{class:"banner-title"},"購物車")])],-1)),L={class:"container"},V=n(()=>t("div",{class:"order-process-btn py-5"},[t("button",{button:"",type:"button",class:"btn btn-primary active"}," Step1 建立訂單 "),t("button",{button:"",type:"button",class:"btn btn-outline-primary"}," Step2 確認付款 "),t("button",{button:"",type:"button",class:"btn btn-outline-primary"}," Step3 付款完成 ")],-1)),q={class:"row g-5 order"},U={class:"col-md-12 bg-light p-4"},B=n(()=>t("h4",{class:"title w-100 text-center mb-4"},"訂單內容",-1)),D={class:"table align-middle"},M=n(()=>t("thead",{class:"text-center"},[t("tr",null,[t("th",{width:"25%"},"圖片"),t("th",{width:"25%"},"商品名稱"),t("th",{width:"25%"},"數量"),t("th",{width:"25%"},"價格")])],-1)),N={style:{width:"200px"}},z={class:"text-center"},E={class:"text-center"},F={class:"input-group input-group-sm"},G={class:"input-group"},Q=["onUpdate:modelValue","value","onChange"],$=["value"],j={class:"input-group-text",id:"basic-addon2"},H={class:"text-center"},R={class:"text-muted"},A={class:"text-center"},J=["onClick","disabled"],K=n(()=>t("i",{class:"bi bi-x"},null,-1)),O=[K],P={class:"input-group"},W=["placeholder","disabled"],X={class:"discount"},Y={class:"text-end"},Z=n(()=>t("small",null,"總金額：",-1)),tt={key:0,class:"text-end"},st=n(()=>t("small",{class:"text-success"},"折扣價",-1)),et={class:"text-success"},ot={class:"d-flex justify-content-center"};function at(s,o,i,h,a,u){return r(),d("div",null,[T,t("section",L,[V,t("div",q,[t("div",U,[B,t("table",D,[M,t("tbody",null,[a.cart.carts?(r(!0),d(p,{key:0},_(a.cart.carts,e=>(r(),d("tr",{key:e.id},[t("td",N,[t("div",{style:x([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${e.product.imageUrl})`}])},null,4)]),t("td",z,c(e.product.title),1),t("td",E,[t("div",F,[t("div",G,[b(t("select",{"onUpdate:modelValue":l=>e.qty=l,class:"form-select",value:e.qty,onChange:()=>u.selectCartQty(e.id,e.qty)},[(r(),d(p,null,_(20,l=>t("option",{value:l,key:l},c(l),9,$)),64))],40,Q),[[S,e.qty,void 0,{number:!0}]]),t("span",j,c(e.product.unit),1)])])]),t("td",H,[t("small",R,"NT$"+c(e.total),1)]),t("td",A,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:l=>u.removeCartItem(e.id),disabled:a.loadingStatus.loadingItem===e.id},O,8,J)])]))),128)):g("",!0)])]),t("div",P,[b(t("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>a.couponCode=e),type:"text",placeholder:a.total-a.finalTotal!==0?"已成功套用折扣碼!!":"輸入折扣碼",disabled:a.total-a.finalTotal!==0,class:"form-control"},null,8,W),[[y,a.couponCode]]),t("button",{class:"input-group-text",id:"basic-addon2",onClick:o[1]||(o[1]=f((...e)=>u.getCoupons&&u.getCoupons(...e),["prevent"]))},"套用")]),t("div",null,[t("div",X,[t("p",Y,[Z,t("small",null,c(a.cart.total),1)]),a.cart.final_total!==a.cart.total?(r(),d("p",tt,[st,t("small",et,c(a.cart.final_total),1)])):g("",!0)])]),t("div",ot,[t("button",{class:"btn btn-primary",onClick:o[2]||(o[2]=e=>s.$router.push({path:"/confirmCart"}))}," 下一步 ")])])])])])}const it=m(I,[["render",at],["__scopeId","data-v-723dc839"]]);export{it as default};
